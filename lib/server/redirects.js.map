{"version":3,"sources":["../../src/server/redirects.js"],"names":["useRedirects","redirects","app","router","use","routes","forEach","get","r","dest","params","reduce","value","key","replace","console","log","request","url","status","redirect"],"mappings":";;;;;;;;;;;;;;kBAQwBA,Y;;AARxB;;;;;;AAEA,IAAMC,YAAY;AACd;AACA,CAAC,eAAD,EAAkB,UAAlB,CAFc,EAGd,CAAC,mBAAD,EAAsB,4BAAtB,CAHc,CAAlB;;AAMe,SAASD,YAAT,CAAsBE,GAAtB,EAA2B;AACtC,QAAMC,SAAS,0BAAf;;AAEAD,QAAIE,GAAJ,CAAQD,OAAOE,MAAP,EAAR;;AAEAJ,cAAUK,OAAV,CAAkB,aAAK;AACnBH,eAAOI,GAAP,CAAWC,EAAE,CAAF,CAAX,0CAAiB;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AACPC,gCADO,GACA,oBAAY,KAAKC,MAAjB,EAAyBC,MAAzB,CACT,UAACC,KAAD,EAAQC,GAAR;AAAA,uCAAgBD,MAAME,OAAN,CAAc,MAAMD,GAApB,EAAyB,MAAKH,MAAL,CAAYG,GAAZ,CAAzB,CAAhB;AAAA,6BADS,EAETL,EAAE,CAAF,CAFS,CADA;;AAKbO,oCAAQC,GAAR,wBACyBR,EAAE,CAAF,CADzB,UACkC,KAAKS,OAAL,CAAaC,GAD/C,YACyDT,IADzD;AAGA,iCAAKU,MAAL,GAAcX,EAAE,CAAF,KAAQ,GAAtB;AACA,iCAAKY,QAAL,CAAcX,IAAd;;AATa;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAAjB;AAWH,KAZD;AAaH","file":"redirects.js","sourcesContent":["import koa_router from 'koa-router';\n\nconst redirects = [\n    // example: [/\\/about(\\d+)-(.+)/, '/about?$0:$1', 302],\n    [/^\\/recent\\/?$/, '/created'],\n    [/^\\/pick_account.*/, 'https://signup.steemit.com'],\n];\n\nexport default function useRedirects(app) {\n    const router = koa_router();\n\n    app.use(router.routes());\n\n    redirects.forEach(r => {\n        router.get(r[0], function*() {\n            const dest = Object.keys(this.params).reduce(\n                (value, key) => value.replace('$' + key, this.params[key]),\n                r[1]\n            );\n            console.log(\n                `server redirect: [${r[0]}] ${this.request.url} -> ${dest}`\n            );\n            this.status = r[2] || 301;\n            this.redirect(dest);\n        });\n    });\n}\n"]}