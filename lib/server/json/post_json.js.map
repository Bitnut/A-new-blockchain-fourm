{"version":3,"sources":["../../../src/server/json/post_json.jsx"],"names":["usePostJson","app","router","use","routes","get","routeRegex","PostJson","author","url","match","replace","permalink","status","api","getContentAsync","post","json_metadata","JSON","parse","e","body"],"mappings":";;;;;;;;;;kBAKwBA,W;;AALxB;;;;AACA;;;;AACA;;AACA;;;;AAEe,SAASA,WAAT,CAAqBC,GAArB,EAA0B;AACrC,QAAMC,SAAS,0BAAf;AACAD,QAAIE,GAAJ,CAAQD,OAAOE,MAAP,EAAR;;AAEAF,WAAOG,GAAP,CAAWC,yBAAWC,QAAtB,0CAAgC;AAAA;AAAA;AAAA;AAAA;AAAA;AAC5B;AACMC,8BAFsB,GAEb,KAAKC,GAAL,CAASC,KAAT,CAAe,gBAAf,EAAiC,CAAjC,EAAoCC,OAApC,CAA4C,GAA5C,EAAiD,EAAjD,CAFa;AAGtBC,iCAHsB,GAGV,KAAKH,GAAL,CAASC,KAAT,CAAe,6BAAf,EAA8C,CAA9C,CAHU;AAIxBG,8BAJwB,GAIf,EAJe;AAAA;AAAA,+BAKXC,aAAIC,eAAJ,CAAoBP,MAApB,EAA4BI,SAA5B,CALW;;AAAA;AAKxBI,4BALwB;;;AAO5B,4BAAIA,KAAKR,MAAT,EAAiB;AACbK,qCAAS,KAAT;AACA;AACA,gCAAI;AACAG,qCAAKC,aAAL,GAAqBC,KAAKC,KAAL,CAAWH,KAAKC,aAAhB,CAArB;AACH,6BAFD,CAEE,OAAOG,CAAP,EAAU;AACRJ,qCAAKC,aAAL,GAAqB,EAArB;AACH;AACJ,yBARD,MAQO;AACHD,mCAAO,eAAP;AACAH,qCAAS,KAAT;AACH;AACD;AACA,6BAAKQ,IAAL,GAAY,EAAEL,UAAF,EAAQH,cAAR,EAAZ;;AApB4B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAAhC;AAsBH","file":"post_json.js","sourcesContent":["import koa_router from 'koa-router';\nimport React from 'react';\nimport { routeRegex } from 'app/ResolveRoute';\nimport { api } from '@steemit/steem-js';\n\nexport default function usePostJson(app) {\n    const router = koa_router();\n    app.use(router.routes());\n\n    router.get(routeRegex.PostJson, function*() {\n        // validate and build post details in JSON\n        const author = this.url.match(/(\\@[\\w\\d\\.-]+)/)[0].replace('@', '');\n        const permalink = this.url.match(/(\\@[\\w\\d\\.-]+)\\/?([\\w\\d-]+)/)[2];\n        let status = '';\n        let post = yield api.getContentAsync(author, permalink);\n\n        if (post.author) {\n            status = '200';\n            // try parse for post metadata\n            try {\n                post.json_metadata = JSON.parse(post.json_metadata);\n            } catch (e) {\n                post.json_metadata = '';\n            }\n        } else {\n            post = 'No post found';\n            status = '404';\n        }\n        // return response and status code\n        this.body = { post, status };\n    });\n}\n"]}