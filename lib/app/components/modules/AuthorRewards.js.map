{"version":3,"sources":["../../../../src/app/components/modules/AuthorRewards.jsx"],"names":["AuthorRewards","state","historyIndex","onShowDeposit","setState","showDeposit","onShowDepositSteem","depositType","LIQUID_TICKER","onShowDepositPower","VEST_TICKER","nextProps","nextState","transfer_history","length","props","back","newIndex","Math","max","account_name","rewards24Vests","rewardsWeekVests","totalRewardsVests","rewards24Steem","rewardsWeekSteem","totalRewardsSteem","rewards24SBD","rewardsWeekSBD","totalRewardsSBD","today","Date","oneDay","yesterday","getTime","lastWeek","firstDate","finalDate","author_log","map","item","index","op","timestamp","vest","vesting_payout","steem","steem_payout","sbd","sbd_payout","DEBT_TICKER","filter","el","currentIndex","curationLength","daysOfCuration","averageCurationVests","averageCurationSteem","averageCurationSBD","hasFullWeek","limitedIndex","min","reverse","navButtons","_setHistoryPage","bind","VESTING_TOKEN","toFixed","DEBT_TOKEN_SHORT","React","Component","ownProps","account","name"],"mappings":"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","file":"AuthorRewards.js","sourcesContent":["/* eslint react/prop-types: 0 */\nimport React from 'react';\nimport { connect } from 'react-redux';\nimport TransferHistoryRow from 'app/components/cards/TransferHistoryRow';\nimport {\n    numberWithCommas,\n    vestsToSp,\n    assetFloat,\n} from 'app/utils/StateFunctions';\nimport tt from 'counterpart';\nimport {\n    VESTING_TOKEN,\n    LIQUID_TICKER,\n    VEST_TICKER,\n    DEBT_TICKER,\n    DEBT_TOKEN_SHORT,\n} from 'app/client_config';\n\nclass AuthorRewards extends React.Component {\n    constructor() {\n        super();\n        this.state = { historyIndex: 0 };\n        this.onShowDeposit = () => {\n            this.setState({ showDeposit: !this.state.showDeposit });\n        };\n        this.onShowDepositSteem = () => {\n            this.setState({\n                showDeposit: !this.state.showDeposit,\n                depositType: LIQUID_TICKER,\n            });\n        };\n        this.onShowDepositPower = () => {\n            this.setState({\n                showDeposit: !this.state.showDeposit,\n                depositType: VEST_TICKER,\n            });\n        };\n        // this.onShowDeposit = this.onShowDeposit.bind(this)\n    }\n\n    shouldComponentUpdate(nextProps, nextState) {\n        return (\n            nextProps.transfer_history.length !==\n                this.props.transfer_history.length ||\n            nextState.historyIndex !== this.state.historyIndex\n        );\n    }\n\n    _setHistoryPage(back) {\n        const newIndex = this.state.historyIndex + (back ? 10 : -10);\n        this.setState({ historyIndex: Math.max(0, newIndex) });\n    }\n\n    render() {\n        const { state: { historyIndex } } = this;\n        const { account_name, transfer_history } = this.props;\n\n        /// transfer log\n        let rewards24Vests = 0,\n            rewardsWeekVests = 0,\n            totalRewardsVests = 0;\n        let rewards24Steem = 0,\n            rewardsWeekSteem = 0,\n            totalRewardsSteem = 0;\n        let rewards24SBD = 0,\n            rewardsWeekSBD = 0,\n            totalRewardsSBD = 0;\n        const today = new Date();\n        const oneDay = 86400 * 1000;\n        const yesterday = new Date(today.getTime() - oneDay).getTime();\n        const lastWeek = new Date(today.getTime() - 7 * oneDay).getTime();\n\n        let firstDate, finalDate;\n        let author_log = transfer_history\n            .map((item, index) => {\n                // Filter out rewards\n                if (item[1].op[0] === 'author_reward') {\n                    if (!finalDate) {\n                        finalDate = new Date(item[1].timestamp).getTime();\n                    }\n                    firstDate = new Date(item[1].timestamp).getTime();\n\n                    const vest = assetFloat(\n                        item[1].op[1].vesting_payout,\n                        VEST_TICKER\n                    );\n                    const steem = assetFloat(\n                        item[1].op[1].steem_payout,\n                        LIQUID_TICKER\n                    );\n                    const sbd = assetFloat(\n                        item[1].op[1].sbd_payout,\n                        DEBT_TICKER\n                    );\n\n                    if (new Date(item[1].timestamp).getTime() > lastWeek) {\n                        if (new Date(item[1].timestamp).getTime() > yesterday) {\n                            rewards24Vests += vest;\n                            rewards24Steem += steem;\n                            rewards24SBD += sbd;\n                        }\n                        rewardsWeekVests += vest;\n                        rewardsWeekSteem += steem;\n                        rewardsWeekSBD += sbd;\n                    }\n                    totalRewardsVests += vest;\n                    totalRewardsSteem += steem;\n                    totalRewardsSBD += sbd;\n\n                    return (\n                        <TransferHistoryRow\n                            key={index}\n                            op={item}\n                            context={account_name}\n                        />\n                    );\n                }\n                return null;\n            })\n            .filter(el => !!el);\n\n        let currentIndex = -1;\n        const curationLength = author_log.length;\n        const daysOfCuration = (firstDate - finalDate) / oneDay || 1;\n        const averageCurationVests = !daysOfCuration\n            ? 0\n            : totalRewardsVests / daysOfCuration;\n        const averageCurationSteem = !daysOfCuration\n            ? 0\n            : totalRewardsSteem / daysOfCuration;\n        const averageCurationSBD = !daysOfCuration\n            ? 0\n            : totalRewardsSBD / daysOfCuration;\n        const hasFullWeek = daysOfCuration >= 7;\n        const limitedIndex = Math.min(historyIndex, curationLength - 10);\n        author_log = author_log.reverse().filter(() => {\n            currentIndex++;\n            return (\n                currentIndex >= limitedIndex && currentIndex < limitedIndex + 10\n            );\n        });\n\n        const navButtons = (\n            <nav>\n                <ul className=\"pager\">\n                    <li>\n                        <div\n                            className={\n                                'button tiny hollow float-left ' +\n                                (historyIndex === 0 ? ' disabled' : '')\n                            }\n                            onClick={this._setHistoryPage.bind(this, false)}\n                            aria-label=\"Previous\"\n                        >\n                            <span aria-hidden=\"true\">\n                                &larr; {tt('g.newer')}\n                            </span>\n                        </div>\n                    </li>\n                    <li>\n                        <div\n                            className={\n                                'button tiny hollow float-right ' +\n                                (historyIndex >= curationLength - 10\n                                    ? ' disabled'\n                                    : '')\n                            }\n                            onClick={\n                                historyIndex >= curationLength - 10\n                                    ? null\n                                    : this._setHistoryPage.bind(this, true)\n                            }\n                            aria-label=\"Next\"\n                        >\n                            <span aria-hidden=\"true\">\n                                {tt('g.older')} &rarr;\n                            </span>\n                        </div>\n                    </li>\n                </ul>\n            </nav>\n        );\n        return (\n            <div className=\"UserWallet\">\n                <div className=\"UserWallet__balance UserReward__row row\">\n                    <div className=\"column small-12 medium-8\">\n                        {tt(\n                            'authorrewards_jsx.estimated_author_rewards_last_week'\n                        )}:\n                    </div>\n                    <div className=\"column small-12 medium-4\">\n                        {numberWithCommas(\n                            vestsToSp(\n                                this.props.state,\n                                rewardsWeekVests + ' ' + VEST_TICKER\n                            )\n                        ) +\n                            ' ' +\n                            VESTING_TOKEN}\n                        <br />\n                        {rewardsWeekSteem.toFixed(3) + ' ' + LIQUID_TICKER}\n                        <br />\n                        {rewardsWeekSBD.toFixed(3) + ' ' + DEBT_TOKEN_SHORT}\n                    </div>\n                </div>\n\n                <div className=\"row\">\n                    <div className=\"column small-12\">\n                        <hr />\n                    </div>\n                </div>\n\n                <div className=\"row\">\n                    <div className=\"column small-12\">\n                        {/** history */}\n                        <h4>\n                            {tt('authorrewards_jsx.author_rewards_history')}\n                        </h4>\n                        <table>\n                            <tbody>{author_log}</tbody>\n                        </table>\n                        {navButtons}\n                    </div>\n                </div>\n            </div>\n        );\n    }\n}\n\nexport default connect(\n    // mapStateToProps\n    (state, ownProps) => {\n        const { account } = ownProps;\n        return {\n            state,\n            account_name: account.name,\n            transfer_history: account.transfer_history || [],\n        };\n    }\n)(AuthorRewards);\n"]}