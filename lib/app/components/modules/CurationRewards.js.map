{"version":3,"sources":["../../../../src/app/components/modules/CurationRewards.jsx"],"names":["CurationRewards","state","historyIndex","onShowDeposit","setState","showDeposit","onShowDepositSteem","depositType","LIQUID_TICKER","onShowDepositPower","VEST_TICKER","nextProps","nextState","transfer_history","length","props","back","newIndex","Math","max","account_name","rewards24","rewardsWeek","totalRewards","today","Date","oneDay","yesterday","getTime","lastWeek","firstDate","finalDate","curation_log","map","item","index","op","timestamp","vest","reward","filter","el","currentIndex","curationLength","daysOfCuration","averageCuration","hasFullWeek","limitedIndex","min","reverse","navButtons","_setHistoryPage","bind","VESTING_TOKEN","React","Component","ownProps","account","name"],"mappings":"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","file":"CurationRewards.js","sourcesContent":["/* eslint react/prop-types: 0 */\nimport React from 'react';\nimport { connect } from 'react-redux';\nimport TransferHistoryRow from 'app/components/cards/TransferHistoryRow';\nimport {\n    numberWithCommas,\n    vestsToSp,\n    assetFloat,\n} from 'app/utils/StateFunctions';\nimport tt from 'counterpart';\nimport {\n    APP_NAME,\n    DEBT_TOKEN,\n    DEBT_TOKEN_SHORT,\n    LIQUID_TOKEN,\n    CURRENCY_SIGN,\n    VESTING_TOKEN,\n    LIQUID_TICKER,\n    VEST_TICKER,\n} from 'app/client_config';\n\nclass CurationRewards extends React.Component {\n    constructor() {\n        super();\n        this.state = { historyIndex: 0 };\n        this.onShowDeposit = () => {\n            this.setState({ showDeposit: !this.state.showDeposit });\n        };\n        this.onShowDepositSteem = () => {\n            this.setState({\n                showDeposit: !this.state.showDeposit,\n                depositType: LIQUID_TICKER,\n            });\n        };\n        this.onShowDepositPower = () => {\n            this.setState({\n                showDeposit: !this.state.showDeposit,\n                depositType: VEST_TICKER,\n            });\n        };\n        // this.onShowDeposit = this.onShowDeposit.bind(this)\n    }\n\n    shouldComponentUpdate(nextProps, nextState) {\n        return (\n            nextProps.transfer_history.length !==\n                this.props.transfer_history.length ||\n            nextState.historyIndex !== this.state.historyIndex\n        );\n    }\n\n    _setHistoryPage(back) {\n        const newIndex = this.state.historyIndex + (back ? 10 : -10);\n        this.setState({ historyIndex: Math.max(0, newIndex) });\n    }\n\n    render() {\n        const { state: { historyIndex } } = this;\n        const { transfer_history, account_name } = this.props;\n\n        /// transfer log\n        let rewards24 = 0,\n            rewardsWeek = 0,\n            totalRewards = 0;\n        let today = new Date();\n        let oneDay = 86400 * 1000;\n        let yesterday = new Date(today.getTime() - oneDay).getTime();\n        let lastWeek = new Date(today.getTime() - 7 * oneDay).getTime();\n\n        let firstDate, finalDate;\n        let curation_log = transfer_history\n            .map((item, index) => {\n                // Filter out rewards\n                if (item[1].op[0] === 'curation_reward') {\n                    if (!finalDate) {\n                        finalDate = new Date(item[1].timestamp).getTime();\n                    }\n                    firstDate = new Date(item[1].timestamp).getTime();\n                    const vest = assetFloat(item[1].op[1].reward, VEST_TICKER);\n                    if (new Date(item[1].timestamp).getTime() > yesterday) {\n                        rewards24 += vest;\n                        rewardsWeek += vest;\n                    } else if (\n                        new Date(item[1].timestamp).getTime() > lastWeek\n                    ) {\n                        rewardsWeek += vest;\n                    }\n                    totalRewards += vest;\n                    return (\n                        <TransferHistoryRow\n                            key={index}\n                            op={item}\n                            context={account_name}\n                        />\n                    );\n                }\n                return null;\n            })\n            .filter(el => !!el);\n        let currentIndex = -1;\n        const curationLength = curation_log.length;\n        const daysOfCuration = (firstDate - finalDate) / oneDay || 1;\n        const averageCuration = !daysOfCuration\n            ? 0\n            : totalRewards / daysOfCuration;\n        const hasFullWeek = daysOfCuration >= 7;\n        const limitedIndex = Math.min(historyIndex, curationLength - 10);\n        curation_log = curation_log.reverse().filter(() => {\n            currentIndex++;\n            return (\n                currentIndex >= limitedIndex && currentIndex < limitedIndex + 10\n            );\n        });\n\n        const navButtons = (\n            <nav>\n                <ul className=\"pager\">\n                    <li>\n                        <div\n                            className={\n                                'button tiny hollow float-left ' +\n                                (historyIndex === 0 ? ' disabled' : '')\n                            }\n                            onClick={this._setHistoryPage.bind(this, false)}\n                            aria-label=\"Previous\"\n                        >\n                            <span aria-hidden=\"true\">\n                                &larr; {tt('g.newer')}\n                            </span>\n                        </div>\n                    </li>\n                    <li>\n                        <div\n                            className={\n                                'button tiny hollow float-right ' +\n                                (historyIndex >= curationLength - 10\n                                    ? ' disabled'\n                                    : '')\n                            }\n                            onClick={\n                                historyIndex >= curationLength - 10\n                                    ? null\n                                    : this._setHistoryPage.bind(this, true)\n                            }\n                            aria-label=\"Next\"\n                        >\n                            <span aria-hidden=\"true\">\n                                {tt('g.older')} &rarr;\n                            </span>\n                        </div>\n                    </li>\n                </ul>\n            </nav>\n        );\n\n        return (\n            <div className=\"UserWallet\">\n                <div className=\"UserWallet__balance UserReward__row row\">\n                    <div className=\"column small-12 medium-8\">\n                        {tt(\n                            'curationrewards_jsx.estimated_curation_rewards_last_week'\n                        )}:\n                    </div>\n                    <div className=\"column small-12 medium-4\">\n                        {numberWithCommas(\n                            vestsToSp(\n                                this.props.state,\n                                rewardsWeek + ' ' + VEST_TICKER\n                            )\n                        ) +\n                            ' ' +\n                            VESTING_TOKEN}\n                    </div>\n                </div>\n                <div className=\"row\">\n                    <div className=\"column small-12\">\n                        <hr />\n                    </div>\n                </div>\n\n                <div className=\"row\">\n                    <div className=\"column small-12\">\n                        {/** history */}\n                        <h4>\n                            {tt('curationrewards_jsx.curation_rewards_history')}\n                        </h4>\n                        <table>\n                            <tbody>{curation_log}</tbody>\n                        </table>\n                        {navButtons}\n                    </div>\n                </div>\n            </div>\n        );\n    }\n}\n\nexport default connect(\n    // mapStateToProps\n    (state, ownProps) => {\n        const { account } = ownProps;\n        return {\n            state,\n            account_name: account.name,\n            transfer_history: account.transfer_history || [],\n        };\n    }\n)(CurationRewards);\n"]}