{"version":3,"sources":["../../../src/app/utils/NormalizeProfile.js"],"names":["normalizeProfile","truncate","str","len","trim","length","substring","account","profile","json_metadata","md","JSON","parse","console","error","e","name","about","location","website","profile_image","cover_image","test","indexOf","m","match","linksRe","any"],"mappings":";;;;;;;;;;kBAewBA,gB;;AAfxB;;;;;;AAEA,SAASC,QAAT,CAAkBC,GAAlB,EAAuBC,GAAvB,EAA4B;AACxB,QAAID,GAAJ,EAAS;AACLA,cAAMA,IAAIE,IAAJ,EAAN;AACA,YAAIF,IAAIG,MAAJ,GAAaF,GAAjB,EAAsB;AAClBD,kBAAMA,IAAII,SAAJ,CAAc,CAAd,EAAiBH,MAAM,CAAvB,IAA4B,KAAlC;AACH;AACJ;AACD,WAAOD,GAAP;AACH;;AAED;;;AAGe,SAASF,gBAAT,CAA0BO,OAA1B,EAAmC;AAC9C,QAAI,CAACA,OAAL,EAAc,OAAO,EAAP;;AAEd;AACA,QAAIC,UAAU,EAAd;AACA,QAAID,QAAQE,aAAZ,EAA2B;AACvB,YAAI;AACA,gBAAMC,KAAKC,KAAKC,KAAL,CAAWL,QAAQE,aAAnB,CAAX;AACA,gBAAIC,GAAGF,OAAP,EAAgB;AACZA,0BAAUE,GAAGF,OAAb;AACH;AACD,gBAAI,EAAE,QAAOA,OAAP,uDAAOA,OAAP,MAAkB,QAApB,CAAJ,EAAmC;AAC/BK,wBAAQC,KAAR,CACI,oDADJ,EAEIN,OAFJ;AAIAA,0BAAU,EAAV;AACH;AACJ,SAZD,CAYE,OAAOO,CAAP,EAAU;AACRF,oBAAQC,KAAR,CACI,8BADJ,EAEIP,QAAQE,aAFZ,EAGI,YAHJ,EAIIF,QAAQS,IAJZ;AAMH;AACJ;;AAED;AA5B8C,mBAoC1CR,OApC0C;AAAA,QA8B1CQ,IA9B0C,YA8B1CA,IA9B0C;AAAA,QA+B1CC,KA/B0C,YA+B1CA,KA/B0C;AAAA,QAgC1CC,QAhC0C,YAgC1CA,QAhC0C;AAAA,QAiC1CC,OAjC0C,YAiC1CA,OAjC0C;AAAA,QAkC1CC,aAlC0C,YAkC1CA,aAlC0C;AAAA,QAmC1CC,WAnC0C,YAmC1CA,WAnC0C;;;AAsC9CL,WAAOf,SAASe,IAAT,EAAe,EAAf,CAAP;AACAC,YAAQhB,SAASgB,KAAT,EAAgB,GAAhB,CAAR;AACAC,eAAWjB,SAASiB,QAAT,EAAmB,EAAnB,CAAX;;AAEA,QAAI,KAAKI,IAAL,CAAUN,IAAV,CAAJ,EAAqBA,OAAO,IAAP;AACrB,QAAIG,WAAWA,QAAQd,MAAR,GAAiB,GAAhC,EAAqCc,UAAU,IAAV;AACrC,QAAIA,WAAWA,QAAQI,OAAR,CAAgB,MAAhB,MAA4B,CAAC,CAA5C,EAA+C;AAC3CJ,kBAAU,YAAYA,OAAtB;AACH;AACD,QAAIA,OAAJ,EAAa;AACT;AACA,YAAMK,IAAIL,QAAQM,KAAR,CAAcC,gBAAQC,GAAtB,CAAV;AACA,YAAI,CAACH,CAAD,IAAMA,EAAE,CAAF,MAASL,OAAnB,EAA4B;AACxBA,sBAAU,IAAV;AACH;AACJ;;AAED,QAAIC,iBAAiB,CAAC,eAAeE,IAAf,CAAoBF,aAApB,CAAtB,EACIA,gBAAgB,IAAhB;AACJ,QAAIC,eAAe,CAAC,eAAeC,IAAf,CAAoBD,WAApB,CAApB,EAAsDA,cAAc,IAAd;;AAEtD,WAAO;AACHL,kBADG;AAEHC,oBAFG;AAGHC,0BAHG;AAIHC,wBAJG;AAKHC,oCALG;AAMHC;AANG,KAAP;AAQH","file":"NormalizeProfile.js","sourcesContent":["import linksRe from 'app/utils/Links';\n\nfunction truncate(str, len) {\n    if (str) {\n        str = str.trim();\n        if (str.length > len) {\n            str = str.substring(0, len - 1) + '...';\n        }\n    }\n    return str;\n}\n\n/**\n * Enforce profile data length & format standards.\n */\nexport default function normalizeProfile(account) {\n    if (!account) return {};\n\n    // Parse\n    let profile = {};\n    if (account.json_metadata) {\n        try {\n            const md = JSON.parse(account.json_metadata);\n            if (md.profile) {\n                profile = md.profile;\n            }\n            if (!(typeof profile == 'object')) {\n                console.error(\n                    'Expecting object in account.json_metadata.profile:',\n                    profile\n                );\n                profile = {};\n            }\n        } catch (e) {\n            console.error(\n                'Invalid json metadata string',\n                account.json_metadata,\n                'in account',\n                account.name\n            );\n        }\n    }\n\n    // Read & normalize\n    let {\n        name,\n        about,\n        location,\n        website,\n        profile_image,\n        cover_image,\n    } = profile;\n\n    name = truncate(name, 20);\n    about = truncate(about, 160);\n    location = truncate(location, 30);\n\n    if (/^@/.test(name)) name = null;\n    if (website && website.length > 100) website = null;\n    if (website && website.indexOf('http') === -1) {\n        website = 'http://' + website;\n    }\n    if (website) {\n        // enforce that the url regex matches, and fully\n        const m = website.match(linksRe.any);\n        if (!m || m[0] !== website) {\n            website = null;\n        }\n    }\n\n    if (profile_image && !/^https?:\\/\\//.test(profile_image))\n        profile_image = null;\n    if (cover_image && !/^https?:\\/\\//.test(cover_image)) cover_image = null;\n\n    return {\n        name,\n        about,\n        location,\n        website,\n        profile_image,\n        cover_image,\n    };\n}\n"]}